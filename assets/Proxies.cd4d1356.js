import{r as g,j as o,k as $,c as w,X as _e,b as i,B as b,i as m,Y as ve,Z as xe,$ as ee,a0 as te,d as C,a1 as ge,F as T,a2 as be,a3 as ne,a4 as M,y as D,a5 as we,a6 as re,a7 as O,a8 as oe,a9 as H,aa as q,ab as Ce,ac as ke,u as E,ad as Pe,ae as Se,af as Ne,g as se,C as ae,E as Z,ag as $e,m as G,M as Ae,ah as Le,ai as Oe,aj as Te,ak as De}from"./index.2260f7b0.js";import{C as Be}from"./chevron-down.579dfd00.js";import{F as Ie,p as Fe,A as je,I as Re}from"./Fab.cafef32b.js";import{R as ze,T as Me}from"./TextFitler.f91bbe0f.js";import{f as He}from"./index.b7b985d4.js";import{R as qe}from"./rotate-cw.cedef2d0.js";import{S as Ee}from"./Select.7e8de91b.js";import"./debounce.c2d20996.js";function Ue(e,t){if(e==null)return{};var r=Ke(e,t),n,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)n=a[s],!(t.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function Ke(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,a;for(a=0;a<n.length;a++)s=n[a],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}var U=g.exports.forwardRef(function(e,t){var r=e.color,n=r===void 0?"currentColor":r,s=e.size,a=s===void 0?24:s,l=Ue(e,["color","size"]);return o("svg",{ref:t,xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...l,children:o("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})})});U.propTypes={color:$.exports.string,size:$.exports.oneOfType([$.exports.string,$.exports.number])};U.displayName="Zap";const V=U;function le(e){const t=e.size||24,r=w({[_e.animate]:e.animate});return o("svg",{className:r,xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})})}const Ze="_FlexCenter_1380a_1",Ge={FlexCenter:Ze};function Ve({children:e}){return o("div",{className:Ge.FlexCenter,children:e})}const{useRef:W,useEffect:We}=m;function Ye({onClickPrimaryButton:e,onClickSecondaryButton:t}){const r=W(null),n=W(null);return We(()=>{r.current.focus()},[]),i("div",{onKeyDown:a=>{a.keyCode===39?n.current.focus():a.keyCode===37&&r.current.focus()},children:[o("h2",{children:"Close Connections?"}),o("p",{children:'Click "Yes" to close those connections that are still using the old selected proxy in this group'}),o("div",{style:{height:30}}),i(Ve,{children:[o(b,{onClick:e,ref:r,children:"Yes"}),o("div",{style:{width:20}}),o(b,{onClick:t,ref:n,children:"No"})]})]})}const Xe="_header_1y9js_1",Je="_arrow_1y9js_8",Qe="_isOpen_1y9js_13",et="_btn_1y9js_20",tt="_qty_1y9js_25",k={header:Xe,arrow:Je,isOpen:Qe,btn:et,qty:tt};function ce({name:e,type:t,toggle:r,isOpen:n,qty:s}){const a=g.exports.useCallback(l=>{l.preventDefault(),(l.key==="Enter"||l.key===" ")&&r()},[r]);return i("div",{className:k.header,onClick:r,style:{cursor:"pointer"},tabIndex:0,onKeyDown:a,role:"button",children:[o("div",{children:o(ve,{name:e,type:t})}),typeof s=="number"?o("span",{className:k.qty,children:s}):null,o(b,{kind:"minimal",onClick:r,className:k.btn,title:"Toggle collapsible section",children:o("span",{className:w(k.arrow,{[k.isOpen]:n}),children:o(Be,{size:20})})})]})}const{useMemo:nt}=m;function rt(e,t){return e.filter(r=>{const n=t[r];return n===void 0?!0:n.number!==0})}const A=(e,t)=>{if(e&&typeof e.number=="number"&&e.number>0)return e.number;const r=t&&t.type;return r&&te.indexOf(r)>-1?-1:999999},ot={Natural:e=>e,LatencyAsc:(e,t,r)=>e.sort((n,s)=>{const a=A(t[n],r&&r[n]),l=A(t[s],r&&r[s]);return a-l}),LatencyDesc:(e,t,r)=>e.sort((n,s)=>{const a=A(t[n],r&&r[n]);return A(t[s],r&&r[s])-a}),NameAsc:e=>e.sort(),NameDesc:e=>e.sort((t,r)=>t>r?-1:t<r?1:0)};function st(e,t){const r=t.toLowerCase().split(" ").map(n=>n.trim()).filter(n=>!!n);return r.length===0?e:e.filter(n=>{let s=0;for(;s<r.length;s++){const a=r[s];if(n.toLowerCase().indexOf(a)>-1)return!0}return!1})}function at(e,t,r,n,s,a){let l=[...e];return r&&(l=rt(e,t)),typeof n=="string"&&n!==""&&(l=st(l,n)),ot[s](l,t,a)}function ie(e,t,r,n,s){const[a]=xe(ee);return nt(()=>at(e,t,r,a,n,s),[e,t,r,a,n,s])}const lt="_header_5pmv2_1",ct="_groupHead_5pmv2_5",it="_action_5pmv2_11",F={header:lt,groupHead:ct,action:it},ut="_proxy_8ev0l_1",dt="_now_8ev0l_25",pt="_error_8ev0l_29",ht="_selectable_8ev0l_32",yt="_proxyType_8ev0l_40",ft="_row_8ev0l_51",mt="_proxyName_8ev0l_57",_t="_proxySmall_8ev0l_66",f={proxy:ut,now:dt,error:pt,selectable:ht,proxyType:yt,row:ft,proxyName:mt,proxySmall:_t},vt="_proxyLatency_hz69v_1",xt={proxyLatency:vt};function gt({number:e,color:t}){return o("span",{className:xt.proxyLatency,style:{color:t},children:typeof e=="number"&&e!==0?e+" ms":" "})}const{useMemo:N}=m,P={good:"#67c23a",normal:"#d4b75c",bad:"#e67f3c",na:"#909399"};function ue({number:e}={}){return e===0?P.na:e<200?P.good:e<400?P.normal:typeof e=="number"?P.bad:P.na}function bt(e,t){return te.indexOf(t)>-1?{border:"1px dotted #777"}:{background:ue(e)}}function wt({now:e,name:t,proxy:r,latency:n,isSelectable:s,onClick:a}){const l=N(()=>bt(n,r.type),[n,r]),c=N(()=>{let d=t;return n&&typeof n.number=="number"&&(d+=" "+n.number+" ms"),d},[t,n]),u=g.exports.useCallback(()=>{s&&a&&a(t)},[t,a,s]),p=N(()=>w(f.proxySmall,{[f.now]:e,[f.selectable]:s}),[s,e]),h=g.exports.useCallback(d=>{d.key==="Enter"&&u()},[u]);return o("div",{title:c,className:p,style:l,onClick:u,onKeyDown:h,role:s?"menuitem":""})}function Ct(e){return e==="Shadowsocks"?"SS":e}const kt=e=>({left:e.left+window.scrollX-5,top:e.top+window.scrollY-38});function Pt({children:e,label:t,"aria-label":r}){const[n,s]=ge();return i(T,{children:[g.exports.cloneElement(e,n),o(be,{...s,label:t,"aria-label":r,position:kt})]})}function St({now:e,name:t,proxy:r,latency:n,isSelectable:s,onClick:a}){const l=N(()=>ue(n),[n]),c=g.exports.useCallback(()=>{s&&a&&a(t)},[t,a,s]),u=g.exports.useCallback(h=>{h.key==="Enter"&&c()},[c]),p=N(()=>w(f.proxy,{[f.now]:e,[f.error]:n&&n.error,[f.selectable]:s}),[s,e,n]);return i("div",{tabIndex:0,className:p,onClick:c,onKeyDown:u,role:s?"menuitem":"",children:[o("div",{className:f.proxyName,children:o(Pt,{label:t,"aria-label":"proxy name: "+t,children:o("span",{children:t})})}),i("div",{className:f.row,children:[o("span",{className:f.proxyType,style:{opacity:e?.6:.2},children:Ct(r.type)}),o(gt,{number:n==null?void 0:n.number,color:l})]})]})}const de=(e,{name:t})=>{const r=ne(e),n=M(e);return{proxy:r[t],latency:n[t]}},Nt=C(de)(St),$t=C(de)(wt),At="_list_1oy7w_1",Lt="_listSummaryView_1oy7w_8",pe={list:At,listSummaryView:Lt};function he({all:e,now:t,isSelectable:r,itemOnTapCallback:n}){const s=e;return o("div",{className:pe.list,children:s.map(a=>o(Nt,{onClick:n,isSelectable:r,name:a,now:a===t},a))})}function ye({all:e,now:t,isSelectable:r,itemOnTapCallback:n}){return o("div",{className:pe.listSummaryView,children:e.map(s=>o($t,{onClick:n,isSelectable:r,name:s,now:s===t},s))})}const{createElement:Ot,useCallback:j,useMemo:Tt}=m;function Dt({name:e,all:t,delay:r,hideUnavailableProxies:n,proxySortBy:s,proxies:a,type:l,now:c,isOpen:u,apiConfig:p,dispatch:h}){const d=ie(t,r,n,s,a),v=Tt(()=>l==="Selector",[l]),{app:{updateCollapsibleIsOpen:x},proxies:{requestDelayForProxies:y}}=D(),B=j(()=>{x("proxyGroup",e,!u)},[u,x,e]),I=j(K=>{!v||h(we(p,e,K))},[p,h,e,v]),_=re(!1),me=j(async()=>{if(!_.value){_.set(!0);try{await y(p,d)}catch{}_.set(!1)}},[d,p,y,_]);return i("div",{className:F.group,children:[i("div",{className:F.groupHead,children:[o(ce,{name:e,type:l,toggle:B,qty:d.length,isOpen:u}),o("div",{className:F.action,children:o(O,{label:"Test latency",children:o(b,{kind:"circular",onClick:me,children:o(le,{animate:_.value,size:16})})})})]}),Ot(u?he:ye,{all:d,now:c,isSelectable:v,itemOnTapCallback:I})]})}const Bt=C((e,{name:t,delay:r})=>{const n=ne(e),s=oe(e),a=H(e),l=q(e),c=n[t],{all:u,type:p,now:h}=c;return{all:u,delay:r,hideUnavailableProxies:l,proxySortBy:a,proxies:n,type:p,now:h,isOpen:s[`proxyGroup:${t}`]}})(Dt),{useCallback:fe,useState:It}=m;function Ft({dispatch:e,apiConfig:t,name:r}){return fe(()=>e(Ce(t,r)),[t,e,r])}function jt({dispatch:e,apiConfig:t,names:r}){const[n,s]=It(!1);return[fe(async()=>{if(!n){s(!0);try{await e(ke(t,r))}catch{}s(!1)}},[t,e,r,n]),n]}const{useState:Rt,useCallback:zt}=m;function Mt({isLoading:e}){return e?o(Re,{children:o(V,{width:16,height:16})}):o(V,{width:16,height:16})}function Ht({dispatch:e,apiConfig:t}){const[r,n]=Rt(!1);return[zt(()=>{r||(n(!0),e(Pe(t)).then(()=>n(!1),()=>n(!1)))},[t,e,r]),r]}function qt({dispatch:e,apiConfig:t,proxyProviders:r}){const{t:n}=E(),[s,a]=Ht({dispatch:e,apiConfig:t}),[l,c]=jt({apiConfig:t,dispatch:e,names:r.map(u=>u.name)});return o(Ie,{icon:o(Mt,{isLoading:a}),onClick:s,text:n("Test Latency"),style:Fe,children:r.length>0?o(je,{text:n("update_all_proxy_provider"),onClick:l,children:o(ze,{isRotating:c})}):null})}const Et="_updatedAt_1rx92_1",Ut="_main_1rx92_8",Kt="_head_1rx92_17",Zt="_action_1rx92_23",Gt="_refresh_1rx92_31",S={updatedAt:Et,main:Ut,head:Kt,action:Zt,refresh:Gt},{useCallback:Y}=m;function Vt({name:e,proxies:t,delay:r,hideUnavailableProxies:n,proxySortBy:s,vehicleType:a,updatedAt:l,isOpen:c,dispatch:u,apiConfig:p}){const h=ie(t,r,n,s),d=re(!1),v=Ft({dispatch:u,apiConfig:p,name:e}),x=Y(()=>{if(d.value)return;d.set(!0);const _=()=>d.set(!1);u(Se(p,e)).then(_,_)},[p,u,e,d]),{app:{updateCollapsibleIsOpen:y}}=D(),B=Y(()=>{y("proxyProvider",e,!c)},[c,y,e]),I=He(new Date(l),new Date);return i("div",{className:S.main,children:[i("div",{className:S.head,children:[o(ce,{name:e,toggle:B,type:a,isOpen:c,qty:h.length}),i("div",{className:S.action,children:[o(O,{label:"Update",children:o(b,{kind:"circular",onClick:v,children:o(Xt,{})})}),o(O,{label:"Health Check",children:o(b,{kind:"circular",onClick:x,children:o(le,{animate:d.value,size:16})})})]})]}),o("div",{className:S.updatedAt,children:i("small",{children:["Updated ",I," ago"]})}),c?o(he,{all:h}):o(ye,{all:h})]})}const Wt={rest:{scale:1},pressed:{scale:.95}},Yt={rest:{rotate:0},hover:{rotate:360,transition:{duration:.3}}};function Xt(){const t=Ne.read().motion;return o(t.div,{className:S.refresh,variants:Wt,initial:"rest",whileHover:"hover",whileTap:"pressed",children:o(t.div,{className:"flexCenter",variants:Yt,children:o(qe,{size:16})})})}const Jt=(e,{proxies:t,name:r})=>{const n=q(e),s=M(e),a=oe(e),l=se(e),c=H(e);return{apiConfig:l,proxies:t,delay:s,hideUnavailableProxies:n,proxySortBy:c,isOpen:a[`proxyProvider:${r}`]}},Qt=C(Jt)(Vt);function en({items:e}){return e.length===0?null:i(T,{children:[o(ae,{title:"Proxy Provider"}),o("div",{children:e.map(t=>o(Qt,{name:t.name,proxies:t.proxies,type:t.type,vehicleType:t.vehicleType,updatedAt:t.updatedAt},t.name))})]})}const tn="_labeledInput_cmki0_1",R={labeledInput:tn},nn=[["Natural","order_natural"],["LatencyAsc","order_latency_asc"],["LatencyDesc","order_latency_desc"],["NameAsc","order_name_asc"],["NameDesc","order_name_desc"]],{useCallback:X}=m;function rn({appConfig:e}){const{app:{updateAppConfig:t}}=D(),r=X(a=>{t("proxySortBy",a.target.value)},[t]),n=X(a=>{t("hideUnavailableProxies",a)},[t]),{t:s}=E();return i(T,{children:[i("div",{className:R.labeledInput,children:[o("span",{children:s("sort_in_grp")}),o("div",{children:o(Ee,{options:nn.map(a=>[a[0],s(a[1])]),selected:e.proxySortBy,onChange:r})})]}),o("hr",{}),i("div",{className:R.labeledInput,children:[o("span",{children:s("hide_unavail_proxies")}),o("div",{children:o(Z,{name:"hideUnavailableProxies",checked:e.hideUnavailableProxies,onChange:n})})]}),i("div",{className:R.labeledInput,children:[o("span",{children:s("auto_close_conns")}),o("div",{children:o(Z,{name:"autoCloseOldConns",checked:e.autoCloseOldConns,onChange:a=>t("autoCloseOldConns",a)})})]})]})}const on=e=>{const t=H(e),r=q(e),n=$e(e);return{appConfig:{proxySortBy:t,hideUnavailableProxies:r,autoCloseOldConns:n}}},sn=C(on)(rn),an="_overlay_uuk3b_1",ln="_cnt_uuk3b_5",cn="_afterOpen_uuk3b_16",z={overlay:an,cnt:ln,afterOpen:cn},{useMemo:un}=m;function J({isOpen:e,onRequestClose:t,children:r}){const n=un(()=>({base:w(G.content,z.cnt),afterOpen:z.afterOpen,beforeClose:""}),[]);return o(Ae,{isOpen:e,onRequestClose:t,className:n,overlayClassName:w(G.overlay,z.overlay),children:r})}function dn({color:e="currentColor",size:t=24}){return i("svg",{fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:t,height:t,stroke:e,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o("path",{d:"M2 6h9M18.5 6H22"}),o("circle",{cx:"16",cy:"6",r:"2"}),o("path",{d:"M22 18h-9M6 18H2"}),o("circle",{r:"2",transform:"matrix(-1 0 0 1 8 18)"})]})}const pn="_topBar_jgy4z_1",hn="_topBarRight_jgy4z_13",yn="_textFilterContainer_jgy4z_22",fn="_group_jgy4z_29",L={topBar:pn,topBarRight:hn,textFilterContainer:yn,group:fn},{useState:mn,useEffect:_n,useCallback:Q,useRef:vn}=m;function xn({dispatch:e,groupNames:t,delay:r,proxyProviders:n,apiConfig:s,showModalClosePrevConns:a}){const l=vn({}),c=Q(()=>{l.current.startAt=Date.now(),e(Le(s)).then(()=>{l.current.completeAt=Date.now()})},[s,e]);_n(()=>{c();const y=()=>{l.current.startAt&&Date.now()-l.current.startAt>3e4&&c()};return window.addEventListener("focus",y,!1),()=>window.removeEventListener("focus",y,!1)},[c]);const[u,p]=mn(!1),h=Q(()=>{p(!1)},[]),{proxies:{closeModalClosePrevConns:d,closePrevConnsAndTheModal:v}}=D(),{t:x}=E();return i(T,{children:[o(J,{isOpen:u,onRequestClose:h,children:o(sn,{})}),i("div",{className:L.topBar,children:[o(ae,{title:x("Proxies")}),i("div",{className:L.topBarRight,children:[o("div",{className:L.textFilterContainer,children:o(Me,{textAtom:ee})}),o(O,{label:x("settings"),children:o(b,{kind:"minimal",onClick:()=>p(!0),children:o(dn,{size:16})})})]})]}),o("div",{children:t.map(y=>o("div",{className:L.group,children:o(Bt,{name:y,delay:r,apiConfig:s,dispatch:e})},y))}),o(en,{items:n}),o("div",{style:{height:60}}),o(qt,{dispatch:e,apiConfig:s,proxyProviders:n}),o(J,{isOpen:a,onRequestClose:d,children:o(Ye,{onClickPrimaryButton:()=>v(s),onClickSecondaryButton:d})})]})}const gn=e=>({apiConfig:se(e),groupNames:Oe(e),proxyProviders:Te(e),delay:M(e),showModalClosePrevConns:De(e)}),An=C(gn)(xn);export{An as default};
